<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>DEN format | KCT framework</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://kulvait.github.io/KCT_doc/den-format.html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><meta name="author" content="Vojtěch Kulvait">
<meta property="og:site_name" content="KCT framework">
<meta property="og:title" content="DEN format">
<meta property="og:url" content="https://kulvait.github.io/KCT_doc/den-format.html">
<meta property="og:description" content="Legacy DEN
Within this framework, the DEN format is used to store volume, projection and other types of data. This is a binary format for storing three-dimensional arrays of uint16, float32 or float64">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-09-13T12:06:01+02:00">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href=".">

            <span id="blog-title">KCT framework</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="categories/using_kct_blog.html" class="nav-link">Using KCT blog</a>
                </li>
<li class="nav-item">
<a href="posts" class="nav-link">Blog posts</a>
                </li>
<li class="nav-item">
<a href="archive.html" class="nav-link">Blog Archive</a>
                </li>
<li class="nav-item">
<a href="categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="den-format.md" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">DEN format</a></h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <h3>Legacy DEN</h3>
<p>Within this framework, the DEN format is used to store volume, projection and other types of data. This is a binary format for storing three-dimensional arrays of uint16, float32 or float64 values. It has a fixed header of 6 bytes representing three uint16 values corresponding to the dimensions of the array dimy, dimx, dimz, respectively. The data after the header is aligned in x-major order and all values are encoded little endian. The x-major alignment means that the value representing the position (ix,iy,iz) in the array has a flat index$ ix + iy * dimx + iz * dimx * dimy$. </p>
<p>The DEN or Dennerlein format is named after the German CT researcher, Dr.Ing. Frank Dennerlein.</p>
<h4>Problems with legacy format</h4>
<p>The type of the data can only be derived from the file size and number of elements represented as given by header. Element size of uint16 is 2 bytes, float32 4 bytes and float64 8 bytes. Thus it is not possible to represent or distinguish two types with 4 bytes element size. Such element must ever be float. This is one limiting factor.</p>
<p>The fact that the order of dimensions in the header is (dimy, dimx, dimz) instead of the more natural (dimx, dimy, dimz) is questionable. This is more common in matrix notation, where we first list the number of rows and then the number of columns. For multidimensional arrays, this is counterintuitive. There is no support for y-major alignment, where matrix data of dimensions (dimy, dimx) would be stored column by column. In addition, a single dimension can have a maximum of 65535 elements.</p>
<p>Fixing number of dimensions to 3 also reduces flexibility of the format. In some situations would be nice to be able to represent 1D arrays or arrays of greater dimensions than 3D.</p>
<h3>Extended DEN format</h3>
<p>To address problems with legacy DEN format, KCT library implements also extended DEN, which is binary format to store multidimensional arrays of up to 16 dimensions. It follows a concept of small header followed by data entries. Extended DEN files with data are not valid legacy DEN files to be able to distinguish them by parsers. It is due to the fact, that the header of the extended file start with uint16(0). </p>
<p>The extended format preserves the use of little endian encoding and also the concept of a fixed-length header followed by a data set. For the sake of data alignment in memory, we decided to use a header length of 4096 bytes. For now it uses just 74 bytes. First 5 uint16 values are the following. First is 0, then number of dimensions that needs to be less than 16, then byte size of the element, x-major or y-major specifier and type of the element specifier.</p>
<p><img src="images/DENEXT_header1.svg"></p>
<p>They are followed by up to 16 dimension specification values.</p>
<p><img src="images/DENEXT_header2.svg"></p>
<p>Supported element types and byte sizes are listed in the following Java code from DEN file opener, where the element type ids are in comments:</p>
<pre class="code literal-block"><span class="kd">public</span> <span class="kd">enum</span> <span class="n">DenDataType</span> <span class="p">{</span>
    <span class="c1">// Ordinal num is the position in the enum</span>
    <span class="c1">// thus for this enum is the ordinal important as its the code in DEX file</span>
    <span class="n">UINT16</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="c1">// 0</span>
    <span class="n">INT16</span><span class="p">(</span><span class="mi">2</span><span class="p">),</span> <span class="c1">// 1</span>
    <span class="n">UINT32</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="c1">// 2</span>
    <span class="n">INT32</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="c1">// 3</span>
    <span class="n">UINT64</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="c1">// 4</span>
    <span class="n">INT64</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="c1">// 5</span>
    <span class="n">FLOAT32</span><span class="p">(</span><span class="mi">4</span><span class="p">),</span> <span class="c1">// 6</span>
    <span class="n">FLOAT64</span><span class="p">(</span><span class="mi">8</span><span class="p">),</span> <span class="c1">// 7</span>
    <span class="n">UINT8</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span> <span class="c1">// 8</span>

    <span class="kd">private</span> <span class="kd">final</span> <span class="kt">int</span> <span class="n">byteSize</span><span class="p">;</span>
    <span class="kd">private</span> <span class="nf">DenDataType</span><span class="p">(</span><span class="kt">int</span> <span class="n">byteSize</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="na">byteSize</span> <span class="o">=</span> <span class="n">byteSize</span><span class="p">;</span> <span class="p">}</span>
    <span class="kd">public</span> <span class="kt">int</span> <span class="nf">getSize</span><span class="p">()</span> <span class="p">{</span> <span class="k">return</span> <span class="n">byteSize</span><span class="p">;</span> <span class="p">}</span>
<span class="p">}</span>
</pre>
<h3>Deprecated extended DEN</h3>
<p>The original implementation of extended format was simpler and is deprecated.</p>
<p>Extended version implemented in KCT is able to represent data with each dimension up to the uint32_t_max. The header in this format is 18bytes and it starts with (0,0,0) or (0,0,1) and continues by (dimy, dimx, dimz) of uint32_t values. Format with initial part of header (0,0,0) has the same row major alignment of the remaining sequence of data, while in the format with initial part of header (0,0,1) the value representing the position (ix,iy,iz) will have a flat index $iy + ix * dimy + iz * dimx * dimy$
therefore the data are in column major order.</p>
    </div>
    
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js?config=TeX-AMS-MML_HTMLorMML" integrity="sha384-3lJUsx1TJHt7BA4udB5KPnDrlkO8T6J6v/op7ui0BbCjvZ9WqV4Xm6DTP6kQ/iBH" crossorigin="anonymous"></script><script type="text/x-mathjax-config">
MathJax.Hub.Config({
    tex2jax: {
        inlineMath: [ ['$','$'], ["\\(","\\)"] ],
        displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
        processEscapes: true
    },
    displayAlign: 'center', // Change this to 'left' if you want left-aligned equations.
    "HTML-CSS": {
        styles: {'.MathJax_Display': {"margin": 0}}
    }
});
</script></article><!--End of body content--><footer id="footer">
            Contents © 2022         <a href="mailto:kulvait%20at%20gmail%20dot%20com">Vojtěch Kulvait</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a> <br><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png">   </a><span xmlns:dct="http://purl.org/dc/terms/" property="dct:title">KCT framework wiki and blog</span> by <span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName">Vojtěch Kulvait</span> is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/">Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License</a>. <br>
KCT framework itself is licensed under the terms of GNU GPL3 license. <br>
Any data provided on this site or within the KCT framework may be subject to different licensing arrangements.

            
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>

