<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article#
" lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Geometry model | KCT framework</title>
<link href="assets/css/all-nocdn.css" rel="stylesheet" type="text/css">
<meta name="theme-color" content="#5670d4">
<meta name="generator" content="Nikola (getnikola.com)">
<link rel="alternate" type="application/rss+xml" title="RSS" hreflang="en" href="rss.xml">
<link rel="canonical" href="https://kulvait.github.io/KCT_doc/geometry-model.html">
<!--[if lt IE 9]><script src="assets/js/html5.js"></script><![endif]--><meta name="author" content="Vojtěch Kulvait">
<meta property="og:site_name" content="KCT framework">
<meta property="og:title" content="Geometry model">
<meta property="og:url" content="https://kulvait.github.io/KCT_doc/geometry-model.html">
<meta property="og:description" content="We expect the setup, where the center of the volume of interest is a reference point, normally identified with the zero of the world coordinates. 
In the situation, where user needs a setup, where the">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2021-09-13T12:22:25+02:00">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.css" integrity="sha384-yFRtMMDnQtDRO8rLpMIKrtPCD5jdktao2TV19YiZYWMDkUR5GQZR/NOVTdquEx1j" crossorigin="anonymous">
</head>
<body>
<a href="#content" class="sr-only sr-only-focusable">Skip to main content</a>

<!-- Menubar -->

<nav class="navbar navbar-expand-md static-top mb-4
navbar-dark
bg-dark
"><div class="container">
<!-- This keeps the margins nice -->
        <a class="navbar-brand" href=".">

            <span id="blog-title">KCT framework</span>
        </a>
        <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#bs-navbar" aria-controls="bs-navbar" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="bs-navbar">
            <ul class="navbar-nav mr-auto">
<li class="nav-item">
<a href="archive.html" class="nav-link">Archive</a>
                </li>
<li class="nav-item">
<a href="categories/" class="nav-link">Tags</a>
                </li>
<li class="nav-item">
<a href="rss.xml" class="nav-link">RSS feed</a>

                
            </li>
</ul>
<ul class="navbar-nav navbar-right">
<li class="nav-item">
    <a href="geometry-model.md" id="sourcelink" class="nav-link">Source</a>
    </li>


                
            </ul>
</div>
<!-- /.navbar-collapse -->
    </div>
<!-- /.container -->
</nav><!-- End of Menubar --><div class="container" id="content" role="main">
    <div class="body-content">
        <!--Body content-->
        
        
        
<article class="post-text storypage" itemscope="itemscope" itemtype="http://schema.org/Article"><header><h1 class="p-name entry-title" itemprop="headline name"><a href="#" class="u-url">Geometry model</a></h1>

        

    </header><div class="e-content entry-content" itemprop="articleBody text">
    <div>
<p>We expect the setup, where the center of the volume of interest is a reference point, normally identified with the zero of the world coordinates. </p>
<p>In the situation, where user needs a setup, where the zero of word coordinates is not at the center of volume, he or she needs to specify the coordinates of the center of the volume in the world coordinates.</p>
<pre class="code literal-block"><span></span><code>    --volume-centerx FLOAT:FLOAT in [-10000 - 10000] Needs: --volume-centery --volume-centerz
                                `X coordinate of the volume center in mm, defaults to 0.00.
    --volume-centery FLOAT:FLOAT in [-10000 - 10000] Needs: --volume-centerx --volume-centerz
                                `Y coordinate of the volume center in mm, defaults to 0.00.
    --volume-centerz FLOAT:FLOAT in [-10000 - 10000] Needs: --volume-centerx --volume-centery
                                `Z coordinate of the volume center in mm, defaults to 0.00.
</code></pre>


<p>By this mechanism it is possible to reconstruct the volume outside the zero of the world coordinates, that is usually connected with the center of rotation.</p>
<p>The geometry model of the most of the projectors expects that the rotation axis is parallel with the $x_3$ axis of the world coordinates, that the detector cells are rectangle shaped with the dimensions $\chi_1$ and $\chi_2$ and $\chi_2$ is parallel wit the $x_2$.</p>
<h2>Example geometry setup</h2>
<h3>Example volume</h3>
<p>We use available tools to download and use a publicly available CT volume to demonstrate typical geometry setup and basic work with the tool.
First I selected the dataset from <a href="https://public.cancerimagingarchive.net/">The Cancer Imaging Archive</a> containing a brain CT scan, ID TCGA-19-1787.
Using the procedure described on (their pages)[https://wiki.cancerimagingarchive.net/display/NBIA/Downloading+TCIA+Images], I have downloaded the set of DICOM files related to this dataset. Because for the purpose of this example, I intend to transform this dataset into the raw format, that can be used by the tool, I would like to mention, that these data are published under the terms of Creative Commons Attribution 3.0 Unported License (http://creativecommons.org/licenses/by/3.0/) and the <a href="License-to-use-TCGA-GBM-collection-or-derived-patient-data-(Example-CT-scan)">following terms</a>. This licencing apply to any user even the user of the derived data, which I publish here in scope of this demonstration.</p>
<p>From the DICOM header we can see that it is a scan on SIEMENS Sensation Cardiac 64 CT machine. It contains 124 slices with the thickness of 1.5mm of the dimension 512x512, the voxel sizes are (0.64453125mm, 0.64453125mm, 1.5mm). To work with such data in the KCT, we first need to convert it to the raw format called DEN that is used by KCT. We do it using <a href="https://github.com/kulvait/KCT_denpy">KCT_denpy package</a>. This package allow us to convert any numpy.ndarray into the DEN file. In DICOM files the attenuations are encoded in Hounsfield units. For the reconstruction or projection of it, it is however needed to convert them into the raw attenuation values. This can be done in the <a href="https://github.com/kulvait/KCT_dentk">KCT_dentk</a> package by means of the program dentk-fromhu. DEN files created by the described can be found at https://github.com/kulvait/KCT_den_file_opener/releases/download/v1.1.1/ExampleVolumeKCT_TCGA-19-1787.tar.xf, namely DEN_RAW/Series_00.den. To vizualize the volume can be used (KCT Den file opener)[https://github.com/kulvait/KCT_den_file_opener/releases/download/v1.1.1/KCT_Den_File_Opener-1.1.1.jar], a plugin to the (ImageJ)[https://imagej.nih.gov/ij/] viewer that works also with (Fiji)[https://imagej.net/software/fiji/]. It is sufficient to put a file KCT_Den_File_Opener-1.1.1.jar into the .imagej/plugins configuration directory of ImageJ.</p>
<p>Investigating the volume in more detail from the perspective of data alignment it is apparent that the convention described on the picture https://www.slicer.org/wiki/File:Coordinate_sytems.png is observed. So that z axis is the axis of the rotation. Y axis goes from the top (above scanned subject) to bottom (under scanned object). Notice also that ImageJ places the (0,0) top left so that the axial image is vizualized in a natural orientation.</p>
<h3>Example scanning trajectory</h3>
<p>Let's reproject the volume we have using theoretical C-Arm FDCT trajectory. Let's say that our device rotates along the axis parallel to the z axis. By angle $\omega$ we denote polar angle between normal to detector that is pointing towards the source and x axis. Let's fix source to isocenter and source to detector lengths and create a setup in which patient is irradiated from 360 different angles corresponding to integer $\omega$ values. Let's create (camera matrices)[https://en.wikipedia.org/wiki/Camera_matrix], which encode this setup. We create them as float64 DEN files, where z dimension will represent number of angles. So that we produce file of dimensions (dimx, dimy, dimz)=(3,4,360).</p>
</div>
    </div>
    
        
        <script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/katex.min.js" integrity="sha384-9Nhn55MVVN0/4OFx7EE5kpFBPsEMZxKTCnA+4fqDmg12eCTqGi6+BB2LjY8brQxJ" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/katex@0.10.2/dist/contrib/auto-render.min.js" integrity="sha384-kWPLUVMOks5AQFrykwIup5lo0m3iMkkHrD0uJ4H5cjeGihAutqP0yW0J6dpFiVkI" crossorigin="anonymous"></script><script>
                renderMathInElement(document.body,
                    {
                        
delimiters: [
    {left: "$$", right: "$$", display: true},
    {left: "\\[", right: "\\]", display: true},
    {left: "\\begin{equation*}", right: "\\end{equation*}", display: true},
    {left: "$", right: "$", display: false},
    {left: "\\(", right: "\\)", display: false}
]

                    }
                );
            </script></article><!--End of body content--><footer id="footer">
            Contents © 2021         <a href="mailto:kulvait@gmail.com">Vojtěch Kulvait</a> - Powered by         <a href="https://getnikola.com" rel="nofollow">Nikola</a>         
            
            
        </footer>
</div>
</div>


        <script src="assets/js/all-nocdn.js"></script><script>
    baguetteBox.run('div#content', {
        ignoreClass: 'islink',
        captions: function(element){var i=element.getElementsByTagName('img')[0];return i===undefined?'':i.alt;}});
    </script>
</body>
</html>
