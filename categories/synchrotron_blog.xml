<?xml version="1.0" encoding="utf-8"?>
<?xml-stylesheet type="text/xsl" href="../assets/xml/rss.xsl" media="all"?><rss version="2.0" xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>KCT framework (Posts about synchrotron_blog)</title><link>https://kulvait.github.io/KCT_doc/</link><description></description><atom:link href="https://kulvait.github.io/KCT_doc/categories/synchrotron_blog.xml" rel="self" type="application/rss+xml"></atom:link><language>en</language><copyright>Contents © 2023 &lt;a href="mailto:kulvait at gmail dot com"&gt;VK&lt;/a&gt; 
&lt;a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"&gt;&lt;img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/80x15.png" /&gt;&amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;/a&gt;&lt;span xmlns:dct="http://purl.org/dc/terms/" property="dct:title"&gt;KCT framework wiki and blog&lt;/span&gt; by &lt;span xmlns:cc="http://creativecommons.org/ns#" property="cc:attributionName"&gt;Vojtěch Kulvait&lt;/span&gt; is licensed under a &lt;a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"&gt;Creative Commons Attribution-NonCommercial-NoDerivatives 4.0 International License&lt;/a&gt;. &lt;br/&gt;
KCT framework itself is licensed under the terms of GNU GPL3 license. &lt;br/&gt;
Any data provided on this site or within the KCT framework may be subject to different licensing arrangements.
</copyright><lastBuildDate>Thu, 02 Mar 2023 14:43:03 GMT</lastBuildDate><generator>Nikola (getnikola.com)</generator><docs>http://blogs.law.harvard.edu/tech/rss</docs><item><title>Synchrotron data analysis 1: Flat field correction</title><link>https://kulvait.github.io/KCT_doc/posts/synchrotron-data-analysis-1-flat-field-correction.html</link><dc:creator>VK</dc:creator><description>&lt;p&gt;My recent work deals with the analysis of synchrotron data for computed tomography. In this series of blog posts I intend to describe some important concepts of the analysis and the tools that can be used for dealing with related issues.&lt;/p&gt;
&lt;p&gt;First step when dealing with the synchrotron data is processing of the raw projection data. Typically it consists from pixel binning, current normalization and flat field correction. In this post I will explain how to use KCT for flat field correction. &lt;/p&gt;
&lt;h3&gt;Input data&lt;/h3&gt;
&lt;p&gt;To do standard flat field correction three sets of projection data are necessary. Let's say MxN are dimensions of the detector, then we need the following three datasets:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Field&lt;/th&gt;
&lt;th&gt;X-rays&lt;/th&gt;
&lt;th&gt;File&lt;/th&gt;
&lt;th&gt;Dimensions&lt;/th&gt;
&lt;th&gt;Explanation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Image data&lt;/td&gt;
&lt;td&gt;on&lt;/td&gt;
&lt;td&gt;img.den&lt;/td&gt;
&lt;td&gt;MxNx$n_img$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector when scanning object&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Flat field&lt;/td&gt;
&lt;td&gt;on&lt;/td&gt;
&lt;td&gt;flat.den&lt;/td&gt;
&lt;td&gt;MxNx$n_flat$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector without scanning object present, other parameters of the imaging system being the same&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Dark field&lt;/td&gt;
&lt;td&gt;off&lt;/td&gt;
&lt;td&gt;dark.den&lt;/td&gt;
&lt;td&gt;MxNx$n_dark$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector without scanning object present without incomming X-rays&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;Standard flat field correction&lt;/h4&gt;
&lt;p&gt;With the scalar quantity G the formula for the flat field correction is as follows
&lt;code&gt;IMG_cor = G * (IMG - DARK)/(FLAT - DARK)&lt;/code&gt; 
Standard flat field correction of the image is pixel-wise, where we first average flat field and dark field to obtain.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;dentk-framecalc1 --avg flat.den flat_avg.den&lt;/code&gt;
&lt;code&gt;dentk-framecalc1 --avg dark.den dark_avg.den&lt;/code&gt;
Then we subtract dark from flat
&lt;code&gt;dentk-calc --subtract flat_avg.den dark_avg.den flat_minus_dark.den&lt;/code&gt;
Then we want to subtract dark_avg.den from every img.den frame.
&lt;code&gt;dentk-framecalc --subtract img.den dark_avg.den img_minus_dark.den&lt;/code&gt;
We can now compute the extinction using
&lt;code&gt;dentk-framecalc --divide img_minus_dark.den flat_minus_dark.den cor.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --inv cor.den expext.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --log expext.den ext.den&lt;/code&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;

&lt;p&gt;First step when dealing with the synchrotron data is processing of the raw projection data. Typically it consists from pixel binning, current normalization and flat field correction. In this post I will explain how to use KCT for flat field correction. &lt;/p&gt;
&lt;h3&gt;Input data&lt;/h3&gt;
&lt;p&gt;To do standard flat field correction three sets of projection data are necessary. Let's say MxN are dimensions of the detector, then we need the following three datasets:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Field&lt;/th&gt;
&lt;th&gt;X-rays&lt;/th&gt;
&lt;th&gt;File&lt;/th&gt;
&lt;th&gt;Dimensions&lt;/th&gt;
&lt;th&gt;Explanation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Image data&lt;/td&gt;
&lt;td&gt;on&lt;/td&gt;
&lt;td&gt;img.den&lt;/td&gt;
&lt;td&gt;MxNx$n_img$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector when scanning object&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Flat field&lt;/td&gt;
&lt;td&gt;on&lt;/td&gt;
&lt;td&gt;flat.den&lt;/td&gt;
&lt;td&gt;MxNx$n_flat$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector without scanning object present, other parameters of the imaging system being the same&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Dark field&lt;/td&gt;
&lt;td&gt;off&lt;/td&gt;
&lt;td&gt;dark.den&lt;/td&gt;
&lt;td&gt;MxNx$n_dark$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector without scanning object present without incomming X-rays&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;Standard flat field correction&lt;/h4&gt;
&lt;p&gt;With the scalar quantity G the formula for the flat field correction is as follows
&lt;code&gt;IMG_cor = G * (IMG - DARK)/(FLAT - DARK)&lt;/code&gt; 
Standard flat field correction of the image is pixel-wise, where we first average flat field and dark field to obtain.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;dentk-framecalc1 --avg flat.den flat_avg.den&lt;/code&gt;
&lt;code&gt;dentk-framecalc1 --avg dark.den dark_avg.den&lt;/code&gt;
Then we subtract dark from flat
&lt;code&gt;dentk-calc --subtract flat_avg.den dark_avg.den flat_minus_dark.den&lt;/code&gt;
Then we want to subtract dark_avg.den from every img.den frame.
&lt;code&gt;dentk-framecalc --subtract img.den dark_avg.den img_minus_dark.den&lt;/code&gt;
We can now compute the extinction using
&lt;code&gt;dentk-framecalc --divide img_minus_dark.den flat_minus_dark.den cor.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --inv cor.den expext.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --log expext.den ext.den&lt;/code&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;

&lt;h3&gt;Input data&lt;/h3&gt;
&lt;p&gt;To do standard flat field correction three sets of projection data are necessary. Let's say MxN are dimensions of the detector, then we need the following three datasets:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Field&lt;/th&gt;
&lt;th&gt;X-rays&lt;/th&gt;
&lt;th&gt;File&lt;/th&gt;
&lt;th&gt;Dimensions&lt;/th&gt;
&lt;th&gt;Explanation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Image data&lt;/td&gt;
&lt;td&gt;on&lt;/td&gt;
&lt;td&gt;img.den&lt;/td&gt;
&lt;td&gt;MxNx$n_img$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector when scanning object&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Flat field&lt;/td&gt;
&lt;td&gt;on&lt;/td&gt;
&lt;td&gt;flat.den&lt;/td&gt;
&lt;td&gt;MxNx$n_flat$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector without scanning object present, other parameters of the imaging system being the same&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Dark field&lt;/td&gt;
&lt;td&gt;off&lt;/td&gt;
&lt;td&gt;dark.den&lt;/td&gt;
&lt;td&gt;MxNx$n_dark$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector without scanning object present without incomming X-rays&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;Standard flat field correction&lt;/h4&gt;
&lt;p&gt;With the scalar quantity G the formula for the flat field correction is as follows
&lt;code&gt;IMG_cor = G * (IMG - DARK)/(FLAT - DARK)&lt;/code&gt; 
Standard flat field correction of the image is pixel-wise, where we first average flat field and dark field to obtain.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;dentk-framecalc1 --avg flat.den flat_avg.den&lt;/code&gt;
&lt;code&gt;dentk-framecalc1 --avg dark.den dark_avg.den&lt;/code&gt;
Then we subtract dark from flat
&lt;code&gt;dentk-calc --subtract flat_avg.den dark_avg.den flat_minus_dark.den&lt;/code&gt;
Then we want to subtract dark_avg.den from every img.den frame.
&lt;code&gt;dentk-framecalc --subtract img.den dark_avg.den img_minus_dark.den&lt;/code&gt;
We can now compute the extinction using
&lt;code&gt;dentk-framecalc --divide img_minus_dark.den flat_minus_dark.den cor.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --inv cor.den expext.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --log expext.den ext.den&lt;/code&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;

&lt;p&gt;To do standard flat field correction three sets of projection data are necessary. Let's say MxN are dimensions of the detector, then we need the following three datasets:&lt;/p&gt;
&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Field&lt;/th&gt;
&lt;th&gt;X-rays&lt;/th&gt;
&lt;th&gt;File&lt;/th&gt;
&lt;th&gt;Dimensions&lt;/th&gt;
&lt;th&gt;Explanation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Image data&lt;/td&gt;
&lt;td&gt;on&lt;/td&gt;
&lt;td&gt;img.den&lt;/td&gt;
&lt;td&gt;MxNx$n_img$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector when scanning object&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Flat field&lt;/td&gt;
&lt;td&gt;on&lt;/td&gt;
&lt;td&gt;flat.den&lt;/td&gt;
&lt;td&gt;MxNx$n_flat$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector without scanning object present, other parameters of the imaging system being the same&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Dark field&lt;/td&gt;
&lt;td&gt;off&lt;/td&gt;
&lt;td&gt;dark.den&lt;/td&gt;
&lt;td&gt;MxNx$n_dark$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector without scanning object present without incomming X-rays&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;Standard flat field correction&lt;/h4&gt;
&lt;p&gt;With the scalar quantity G the formula for the flat field correction is as follows
&lt;code&gt;IMG_cor = G * (IMG - DARK)/(FLAT - DARK)&lt;/code&gt; 
Standard flat field correction of the image is pixel-wise, where we first average flat field and dark field to obtain.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;dentk-framecalc1 --avg flat.den flat_avg.den&lt;/code&gt;
&lt;code&gt;dentk-framecalc1 --avg dark.den dark_avg.den&lt;/code&gt;
Then we subtract dark from flat
&lt;code&gt;dentk-calc --subtract flat_avg.den dark_avg.den flat_minus_dark.den&lt;/code&gt;
Then we want to subtract dark_avg.den from every img.den frame.
&lt;code&gt;dentk-framecalc --subtract img.den dark_avg.den img_minus_dark.den&lt;/code&gt;
We can now compute the extinction using
&lt;code&gt;dentk-framecalc --divide img_minus_dark.den flat_minus_dark.den cor.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --inv cor.den expext.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --log expext.den ext.den&lt;/code&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;

&lt;table&gt;
&lt;thead&gt;
&lt;tr&gt;
&lt;th&gt;Field&lt;/th&gt;
&lt;th&gt;X-rays&lt;/th&gt;
&lt;th&gt;File&lt;/th&gt;
&lt;th&gt;Dimensions&lt;/th&gt;
&lt;th&gt;Explanation&lt;/th&gt;
&lt;/tr&gt;
&lt;/thead&gt;
&lt;tbody&gt;
&lt;tr&gt;
&lt;td&gt;Image data&lt;/td&gt;
&lt;td&gt;on&lt;/td&gt;
&lt;td&gt;img.den&lt;/td&gt;
&lt;td&gt;MxNx$n_img$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector when scanning object&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Flat field&lt;/td&gt;
&lt;td&gt;on&lt;/td&gt;
&lt;td&gt;flat.den&lt;/td&gt;
&lt;td&gt;MxNx$n_flat$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector without scanning object present, other parameters of the imaging system being the same&lt;/td&gt;
&lt;/tr&gt;
&lt;tr&gt;
&lt;td&gt;Dark field&lt;/td&gt;
&lt;td&gt;off&lt;/td&gt;
&lt;td&gt;dark.den&lt;/td&gt;
&lt;td&gt;MxNx$n_dark$&lt;/td&gt;
&lt;td&gt;Intensity data obtained from the detector without scanning object present without incomming X-rays&lt;/td&gt;
&lt;/tr&gt;
&lt;/tbody&gt;
&lt;/table&gt;
&lt;h4&gt;Standard flat field correction&lt;/h4&gt;
&lt;p&gt;With the scalar quantity G the formula for the flat field correction is as follows
&lt;code&gt;IMG_cor = G * (IMG - DARK)/(FLAT - DARK)&lt;/code&gt; 
Standard flat field correction of the image is pixel-wise, where we first average flat field and dark field to obtain.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;dentk-framecalc1 --avg flat.den flat_avg.den&lt;/code&gt;
&lt;code&gt;dentk-framecalc1 --avg dark.den dark_avg.den&lt;/code&gt;
Then we subtract dark from flat
&lt;code&gt;dentk-calc --subtract flat_avg.den dark_avg.den flat_minus_dark.den&lt;/code&gt;
Then we want to subtract dark_avg.den from every img.den frame.
&lt;code&gt;dentk-framecalc --subtract img.den dark_avg.den img_minus_dark.den&lt;/code&gt;
We can now compute the extinction using
&lt;code&gt;dentk-framecalc --divide img_minus_dark.den flat_minus_dark.den cor.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --inv cor.den expext.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --log expext.den ext.den&lt;/code&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;

&lt;h4&gt;Standard flat field correction&lt;/h4&gt;
&lt;p&gt;With the scalar quantity G the formula for the flat field correction is as follows
&lt;code&gt;IMG_cor = G * (IMG - DARK)/(FLAT - DARK)&lt;/code&gt; 
Standard flat field correction of the image is pixel-wise, where we first average flat field and dark field to obtain.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;dentk-framecalc1 --avg flat.den flat_avg.den&lt;/code&gt;
&lt;code&gt;dentk-framecalc1 --avg dark.den dark_avg.den&lt;/code&gt;
Then we subtract dark from flat
&lt;code&gt;dentk-calc --subtract flat_avg.den dark_avg.den flat_minus_dark.den&lt;/code&gt;
Then we want to subtract dark_avg.den from every img.den frame.
&lt;code&gt;dentk-framecalc --subtract img.den dark_avg.den img_minus_dark.den&lt;/code&gt;
We can now compute the extinction using
&lt;code&gt;dentk-framecalc --divide img_minus_dark.den flat_minus_dark.den cor.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --inv cor.den expext.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --log expext.den ext.den&lt;/code&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;

&lt;p&gt;With the scalar quantity G the formula for the flat field correction is as follows
&lt;code&gt;IMG_cor = G * (IMG - DARK)/(FLAT - DARK)&lt;/code&gt; 
Standard flat field correction of the image is pixel-wise, where we first average flat field and dark field to obtain.&lt;/p&gt;
&lt;p&gt;&lt;code&gt;dentk-framecalc1 --avg flat.den flat_avg.den&lt;/code&gt;
&lt;code&gt;dentk-framecalc1 --avg dark.den dark_avg.den&lt;/code&gt;
Then we subtract dark from flat
&lt;code&gt;dentk-calc --subtract flat_avg.den dark_avg.den flat_minus_dark.den&lt;/code&gt;
Then we want to subtract dark_avg.den from every img.den frame.
&lt;code&gt;dentk-framecalc --subtract img.den dark_avg.den img_minus_dark.den&lt;/code&gt;
We can now compute the extinction using
&lt;code&gt;dentk-framecalc --divide img_minus_dark.den flat_minus_dark.den cor.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --inv cor.den expext.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --log expext.den ext.den&lt;/code&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;

&lt;p&gt;&lt;code&gt;dentk-framecalc1 --avg flat.den flat_avg.den&lt;/code&gt;
&lt;code&gt;dentk-framecalc1 --avg dark.den dark_avg.den&lt;/code&gt;
Then we subtract dark from flat
&lt;code&gt;dentk-calc --subtract flat_avg.den dark_avg.den flat_minus_dark.den&lt;/code&gt;
Then we want to subtract dark_avg.den from every img.den frame.
&lt;code&gt;dentk-framecalc --subtract img.den dark_avg.den img_minus_dark.den&lt;/code&gt;
We can now compute the extinction using
&lt;code&gt;dentk-framecalc --divide img_minus_dark.den flat_minus_dark.den cor.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --inv cor.den expext.den&lt;/code&gt;
&lt;code&gt;dentk-calc1 --log expext.den ext.den&lt;/code&gt;&lt;/p&gt;&lt;/body&gt;&lt;/html&gt;
</description><category>synchrotron_blog</category><guid>https://kulvait.github.io/KCT_doc/posts/synchrotron-data-analysis-1-flat-field-correction.html</guid><pubDate>Thu, 25 Aug 2022 19:05:35 GMT</pubDate></item></channel></rss>